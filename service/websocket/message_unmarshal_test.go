package websocket

import (
	"encoding/hex"
	"fmt"
	"github.com/ninjahome/ninja-go/pbs/websocket"
	"google.golang.org/protobuf/proto"
	"testing"
)

func TestUnmarshal(t *testing.T) {
	msg := &websocket.WsMsg{}

	data := "18024afa060a6061616630313061663833663561633734373937626261396635376334613430323363623336386132613339636234383339383164383465333238623033333166333530613130666232653739336438383961616533666261633761353661376112620a606161663031306166383366356163373437393762626139663537633461343032336362333638613261333963623438333938316438346533323862303333316633353061313066623265373933643838396161653366626163376135366137611294010a6061393565373237303139633436323564643063306134303330306162653464643334623865323932613761613632643736326166326632343639653538323539346337383434356363333836336232303564333530623336396466366162613612309d110ae3ad917fd15e84d01ab786d8f34a871a3add63fdae878fd19674178ef5c1ce94911cf20f20211d5f5567b376651294010a603832376533343464363065373666653838316234346233343763393139306566306533343234653434643132323033633565633138373435643133666335373034386664353864373935373938306166336134303064653662616366633832661230cd6deef8e067965c3aa8bf4ee17ec0dbce77f473518060abf8067ceef7fc5385aa0478f706f65638e827228a880180691294010a603861356436646238363733303362616364383039666364306234313562356463343835343363336531346664613861343366383766323633313938643264623938363961386235643163393933393266313661356337316266623537383366341230f8f06d168b4582e81d68221b26acbc0fae33cf5775a52d31cf7385c951e1b3de5b5a746f34af580260a2ef054ba462591294010a603833333332636466633732383237326432343463343762656335376338316463626533303438613066616434653438353532306265643433346233643839363633393638643836346132643739383130643362663361383066346439373936381230c4ec2b10e048d24a57cfc0ca8735cd87819eb9764e2b1d987f04145776dc3a5affcf656d9db4263968cb7688a8fa9f611a508f385929dc46df32567b0fe7f71efce1a0d117fedd1f9669f1d0e46dca70f2e3bf06b95e49847d680e256e59106a96ef3ea1f794483eb7ee4a94c7000c08daf629d4a0583b1008ffe4357ed27a68ff2820b2eca08906"

	buf, err := hex.DecodeString(data)
	if err != nil {
		panic(err)
	}

	err = proto.Unmarshal(buf, msg)
	if err != nil {
		panic(err)
	}

	gim := msg.Payload.(*websocket.WsMsg_GroupMessage).GroupMessage

	for i := 0; i < len(gim.To); i++ {
		fmt.Println("memberId:", gim.To[i].MemberId)
	}
}
